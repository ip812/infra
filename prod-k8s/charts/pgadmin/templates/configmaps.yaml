---
apiVersion: v1
kind: ConfigMap
metadata:
  name: pgadmin-servers
data:
  servers.json: |
    {
      "Servers": {
        {{- with .Values.servers }}
        {{- range $i, $srv := . }}
        "{{ add $i 1 }}": {
          "Name": "{{ $srv.name }}",
          "Group": "Servers",
          "Host": "{{ $srv.host }}",
          "Port": {{ $srv.port | default 5432 }},
          "Username": "{{ $srv.username | default "postgres" }}",
          "MaintenanceDB": "{{ $srv.maintenanceDB | default "postgres" }}",
          "SSLMode": "{{ $srv.sslmode | default "prefer" }}"
        }{{ if not (eq (add $i 1) (len .)) }},{{ end }}
        {{- end }}
        {{- end }}
      }
    }
